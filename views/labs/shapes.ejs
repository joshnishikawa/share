<%- include('../head'); -%>

<style>
  .selected {
    filter: drop-shadow(0 0 0.5rem #0f0);
  }

  /* #colorMenu, #shapeMenu {
    background-image:none !important;
  } */

  #colorMenu .vert-tabs .nav-item, #tagMenuFiller {
    font-weight: bold;
    background: none;
    border: 1px solid #d3d3d4;
    border-top-left-radius: 0.25rem;
    border-bottom-left-radius: 0.25rem;
  }

  #colorMenu .vert-tabs .nav-item:hover, 
  .vert-tabs .nav-item:focus {
    cursor: pointer;
    border-color: #6c757d;
    isolation: isolate;
  }

  #colorMenu .vert-tabs .nav-item.active, 
  #colorMenu .vert-tabs .nav-item.show {
    background-color: #d3d3d4;
    border-color: #d3d3d4;
    border-right: 0px solid;
  }

</style>










<div class="container-fluid g-0">
  <div class="row g-0">
    <div id="colorMenu" style="height:100vh;overflow:hidden;white-space:nowrap;" class="col-1 ps-1">
      <ul class="nav vert-tabs d-flex flex-column" style="height:100%;">
        <li class="nav-item rounded-start p-2" style="color:white;background-color:red;">RED</li>
        <li class="nav-item rounded-start p-2" style="background-color: orange;">ORANGE</li>
          <li class="nav-item rounded-start p-2" style="background-color: yellow;">YELLOW</li>
        <li class="nav-item rounded-start p-2" style="color:white;background-color: green;">GREEN</li>
        <li class="nav-item rounded-start p-2" style="color:white;background-color: blue;">BLUE</li>
        <li class="nav-item rounded-start p-2" style="color:white;background-color: purple;">PURPLE</li>
        <li class="nav-item rounded-start p-2" style="color:white;background-color: black;">BLACK</li>
        <li class="nav-item rounded-start p-2" style="background-color: pink;">PINK</li>
        <li class="nav-item rounded-start p-2" style="color:white;background-color: brown">BROWN</li>
        <div id="tagMenuFiller" class="bg-white border-end-0" style="border-top-left-radius: 0.25rem;flex: auto"></div>
      </ul>
    </div>

    <div id="shapeMenu" class="col-1 bg-white g-0 p-1" style="border:10px solid rgba(0,0,0,0);">
      <div class="shape svg-shape" data-shape="circle">
        <svg class="circle-svg" width="100%" height="100%" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="50" cy="50" r="45" fill="red"/>
        </svg>
      </div>
      <div class="shape svg-shape" data-shape="square">
        <svg class="square-svg" width="100%" height="100%" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="10" width="80" height="80" fill="blue"/>
        </svg>
      </div>
      <div class="shape svg-shape" data-shape="triangle">
        <svg class="triangle-svg" width="100%" height="100%" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <polygon points="50,5 95,95 5,95" fill="green"/>
        </svg>
      </div>
      <div class="shape svg-shape" data-shape="rectangle">
        <svg class="rectangle-svg" width="100%" height="100%" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="10" y="20" width="80" height="60" fill="yellow"/>
        </svg>
      </div>
      <div class="shape svg-shape" data-shape="diamond">
        <svg class="diamond-svg" width="100%" height="100%" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <polygon points="50,5 85,50 50,95 15,50" fill="pink"/>
        </svg>
      </div>
      <div class="shape svg-shape" data-shape="star">
        <svg class="star-svg" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 260 245">
          <path d="m56,237 74-228 74,228L10,96h240" fill="yellow"/>
        </svg>
      </div>
      <div class="shape svg-shape" data-shape="heart">
        <svg class="heart-svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="purple"/>
        </svg>
      </div>
    </div>

  <!-- Canvas area for dragging and dropping shapes -->
    <div class="col-10">
      <div id="canvas" class="border" style="height: 100vh;">
        <!-- Shapes will be added here -->
      </div>
    </div>
  </div>
</div>

<div id="info" class="border border primary"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>

<script>
  $(function() {
    // get canvas from local storage if exists
    const canvas = localStorage.getItem("canvas");
    if (canvas) {
      $("#canvas").html(canvas, function() {
        // make shapes resizable
        $(".existing-shape").resizable({
          containment: "#canvas",
          handles: "all",
          resize: function(event, ui) {
            // Get the current width and height
            const width = ui.size.width;
            const height = ui.size.height;

            // Update the info box with the new dimensions
            $("#info").text(`${width} x ${height}`);
          },
        });
      });
    }

    // add active class to clicked nav-item
    $('#colorMenu .nav-item').on('click', function() {
      let color = $(this).text().toLowerCase();
      $('#colorMenu .nav-item').removeClass('active shadow');
      $('#shapeMenu').css('border', `10px solid ${color}`);
      $('#shapeMenu .svg-shape svg').each(function() {
        $(this).find('path, circle, rect, polygon').attr('fill', color);
      });
      $(this).addClass('active shadow');
    });




    // Remove .selected only when clicking on the canvas outside any shapes.
    $("#canvas").on("mousedown", function(event) {
      if (event.target.id === "canvas") {
        $(".shape").removeClass("selected");
      }
    });


    // remove selected shape when delete key pressed
    $(document).on("keydown", function(event) {
      if (event.key === "Delete") {
        $(".selected").remove();
      }
    });


    function setSelected() {
      // Remove the selected class from all shapes
      $(".shape").removeClass("selected").css("z-index", "0");

      // Add the selected class to the clicked shape
      $(this).addClass("selected svg").css("z-index", "1").resizable({
        containment: "#canvas",
        handles: "all",
        resize: function(event, ui) {
          // Get the current width and height
          const width = ui.size.width;
          const height = ui.size.height;

          // Update the info box with the new dimensions
          $("#info").text(`${width} x ${height}`);
        },
      });
    }


    // Make shapes draggable from the menu
    $(".shape").draggable({
      helper: "clone", // Allows dragging a copy
      revert: "invalid", // Returns the shape if not dropped on canvas
    });

    $("#menu").on("mousedown", ".shape", setSelected);
    $("#canvas").on("mousedown", ".existing-shape", setSelected);
    $("#canvas").on("touchstart", ".existing-shape", setSelected);

    // Make canvas droppable
    $("#canvas").droppable({
      drop: function(event, ui) {
        const shapeType = $(ui.draggable).data("shape");
        const isExistingShape = $(ui.helper).hasClass("existing-shape");

        if (!isExistingShape) {
          const $shape = $(ui.helper).clone();
          $shape.removeClass("ui-draggable-dragging"); // Remove the dragging class
          $shape.removeAttr("style"); // Remove inline styles added by jQuery UI
          $shape.addClass("existing-shape selected");
          const menuWidth = $("#colorMenu").width() + $("#shapeMenu").width();
          const canvasOffset = $(this).offset();
          const relativeTop = ui.offset.top - canvasOffset.top;
          const relativeLeft = ui.offset.left - canvasOffset.left + menuWidth;

          $shape.css({
            position: "absolute",
            top: relativeTop,
            left: relativeLeft,
          });

          $(this).append($shape);
  
          $shape.draggable({
            containment: "#canvas",
          });

          setSelected.call($shape);
        } 
        else {
          $(ui.helper).css({
            top: ui.position.top,
            left: ui.position.left,
          });
        }
        // save canvas to local storage
        localStorage.setItem("canvas", $("#canvas").html());
      }

    });
  });
</script>

<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>

<%- include('../foot'); -%>